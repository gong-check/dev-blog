{"componentChunkName":"component---src-templates-blog-post-js","path":"/BE/범고래/N+1/nplus1/","result":{"data":{"site":{"siteMetadata":{"title":"공책 팀 개발 블로그"}},"markdownRemark":{"id":"b0207c5a-083f-5d84-8419-8646dc49124b","excerpt":"JPA N+1 문제 찾아 삼만리 안녕하세요 공책팀에서 백엔드 개발을 맡고 있는 범고래입니다.\n이번에 프로젝트에 JPA를 사용하면서 N+1 문제가 발생하는 곳을 찾고, 해결하는 시간을 가졌는데요. N+1 문제란? 처음 개발할 때 부터 N+…","html":"<h1>JPA N+1 문제 찾아 삼만리</h1>\n<p>안녕하세요 공책팀에서 백엔드 개발을 맡고 있는 범고래입니다.\n이번에 프로젝트에 JPA를 사용하면서 N+1 문제가 발생하는 곳을 찾고, 해결하는 시간을 가졌는데요.</p>\n<h2>N+1 문제란?</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">💡 N + 1문제란 1번의 쿼리를 실행했을 때 의도치 않게 N번의 쿼리가 추가적으로 실행되는 것을 말합니다.\n예를 들어, 하나의 엔티티를 조회했을 때 그것과 연관된 다른 엔티티를 다시 조회하여 비효율이 발생하는 상황 등이 있습니다. 여러 번의 쿼리를 날리는 것이 아니라, 한번 조회할 때 한 번에 조회하는 것이 더 효율적일텐데 말이죠.</code></pre></div>\n<p>처음 개발할 때 부터 N+1 문제는 없는지 테스트하며 사용했으면 좋았겠지만, JPA를 학습하며 프로젝트를 진행했기 때문에 당시엔 미처 파악하지 못한 메서드가 프로젝트 내에 존재했습니다.</p>\n<p>이를 해결하기 위해 어떤 방식으로 N+1 문제를 찾았고, 어떻게 문제가 발생했는지에 대한 내용을 소개해볼까합니다.</p>\n<hr>\n<h2>처음 N+1 쿼리 문제를 찾는 과정</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/dev-blog/static/cc12bc23537d37e79f94357393f47026/e8950/img.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.26582278481012%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABzElEQVQoz22S3a6aQBSFfZiCzAzIrx5AEXFwFARRQG160T5CmzZNenHSV18NW2l6cnqxsufqy/qZSdx9hfz8CvXlN7JPv5Def2Jx+Q6v+YFl9w1OtIIbJXA9H7bnw3Vd2PbsKfudJvEqwaE+4nr7iLa/4tRcsC9K5OoAmStwIaC5C+h+BN0LobsLTJ0ATFjgjIFxDv6PJst1in1VouvvuHRXUnPpUBxrbHMF0xSY+hG0SEIPM2jRFloswZwAgnMIId5oskzWBOyvd9TNGVXdEEwdSmQyh2nNYDgBDHcONnPALBts5oJbM3I/aoBzAq5Titx2V7T9Dee2Q3NucawbbGUOYbvQgxiGtwAXJrhpPQCMPRw+NUInq3SDoq4IVp3O5O5QViirE/KdguGH0F5S6PMV9HlCd6hguA/nAZjjw3B8cv7scHB4Q91cCCp3e+z2BWS+gxHE0MIM+svm0SPBE3xYKkyDJTkfHfKxQ3UscW57WnkYJEkzpJlEtpXg3gJTLwSn7pxHZNOiLsf3W+A6JWBLC/fUH8VVB6SbLUzLooiDm2kQU7wBLDh7158Yv41UCkVZYV8c//Y33EzuYApBCw8wAvshmO39d+HB4R+P1U6oT0T+ogAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img.png\"\n        title=\"img.png\"\n        src=\"/dev-blog/static/cc12bc23537d37e79f94357393f47026/f058b/img.png\"\n        srcset=\"/dev-blog/static/cc12bc23537d37e79f94357393f47026/c26ae/img.png 158w,\n/dev-blog/static/cc12bc23537d37e79f94357393f47026/6bdcf/img.png 315w,\n/dev-blog/static/cc12bc23537d37e79f94357393f47026/f058b/img.png 630w,\n/dev-blog/static/cc12bc23537d37e79f94357393f47026/40601/img.png 945w,\n/dev-blog/static/cc12bc23537d37e79f94357393f47026/78612/img.png 1260w,\n/dev-blog/static/cc12bc23537d37e79f94357393f47026/e8950/img.png 2000w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>🤔 처음 접근했던 방식은 인수 테스트를 실행했을 때, 발생하는 쿼리를 하나하나 다 찾아 보는 것이었는데요.\n이렇게 보기엔 테스트 개수도 적지 않을 뿐더러, api를 호출할 때 마다 어떤 쿼리가 몇개가 발생하는지 등 한 눈에 파악하기가 힘들었습니다.</p>\n<p>이를 해결하기 위해서, 인수 테스트 전체를 실행하면 api 호출 마다 몇 개의 쿼리가 나가는지, n+1이 의심이 가지는 않는지 등을 한 눈에 볼 수 있게 파일로 추출해주는 라이브러리가 있으면 어떨까라는 생각을 하게 됐습니다.</p>\n<h2>라이브러리 구현 설계</h2>\n<h3>StatementInspector 인터페이스 활용</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/dev-blog/static/d716ce10d6277536a6b71b1823505608/64639/img_1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 24.050632911392405%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAm0lEQVQY052QyQ7DIAxE+f9PTHIHhRAgO2FxNZYctVVPtfTkMcJ4jBqGgbquY/q+p33fCdFao39C3fdN13VRSokppfBjv6i1fvB9hlrN80zAOceInqaJs/f+0TFGriUvy8Ja+rCd0lrTOI5kjCFoay1flkHQIQTWOWfCRrKVIO7Y4bquBLZt40ZoTAaokc/zZOAAHMfxOAXvf/gCsyuC8rdt6s0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img.png\"\n        title=\"img.png\"\n        src=\"/dev-blog/static/d716ce10d6277536a6b71b1823505608/f058b/img_1.png\"\n        srcset=\"/dev-blog/static/d716ce10d6277536a6b71b1823505608/c26ae/img_1.png 158w,\n/dev-blog/static/d716ce10d6277536a6b71b1823505608/6bdcf/img_1.png 315w,\n/dev-blog/static/d716ce10d6277536a6b71b1823505608/f058b/img_1.png 630w,\n/dev-blog/static/d716ce10d6277536a6b71b1823505608/40601/img_1.png 945w,\n/dev-blog/static/d716ce10d6277536a6b71b1823505608/78612/img_1.png 1260w,\n/dev-blog/static/d716ce10d6277536a6b71b1823505608/64639/img_1.png 1568w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">💡 StatementInspector는 SQL문을 가로채고 수정할 수 있는 기능을 제공하는 인터페이스 입니다.\n\n모든 Hibernate SQL문을 가로채 실행되기 전에, SQL문을 변경하여 실행할 수도 있는 신기한 친구입니다.\n\n이것을 사용해서 현재 문제를 어느 정도 해결해 줄 수 있을 것 같다는 생각이 들었습니다.</code></pre></div>\n<p>이미지 출처: <a href=\"https://vladmihalcea.com/hibernate-statementinspector/\">https://vladmihalcea.com/hibernate-statementinspector/</a></p>\n<h3>문제 정의</h3>\n<p>💡 위 설명을 보고 간단하게 Interceptor와 StatementInspector를 활용하면 될 것 같은데요.\n먼저 어떤 문제를 해결할 것인지를 정의해 보았습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">1. 하나의 api를 실행하는 동안 걸리는 시간\n2. 쿼리가 실행된 개수\n3. 어떤 쿼리들이 실행되었는지 리스트업\n4. n+1이 의심되는 로직 체크 (저는 동일한 select 문이 2개 이상 사용한다면, n+1을 의심해 볼 만한 상황으로 판단했습니다. )\n5. 1~4번까지를 기록하여 파일로 추출</code></pre></div>\n<h2>라이브러리 구성</h2>\n<p>생각보다 구현 로직이 간단해서 빠르게 진행해 봤는데요.\n핵심 로직을 수행하는 <code class=\"language-text\">JpaInspector</code>, <code class=\"language-text\">QueryCountInterceptor</code> 가 어떤 역할을 하는지 간단하게만 언급하고 자세한 내용이 궁금하시다면 <a href=\"https://github.com/sogorae/jpa-query-counter\">실제 코드</a>를 봐도 좋을 것 같습니다.</p>\n<h3>JpaInspector로 SQL 가져오기</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/dev-blog/static/fa422719316722043492fab389c58083/eb2af/img_2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.835443037974684%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABc0lEQVQoz32RTZbcIAyE+zBJxoAAg8H/xvb0zCL3P9CXZ/q1Z5dFIYSkEiU9tqhYo6L3mhIa+i4wbwfzWipy7tlCw5kUJV7xlmndWbadaVl/8oYR5zwPMRprNc4pvFNYURhjMCJoI2htMEYjxiBaobWucRG5rYi9/YdSQu4anuUX8/CbaRLEOrw1RG9oncGLxhmF8y3Oe8TaiotAKYVSTbVX88f1i2A1pVPMuWO6JGw7+9rz90wca88+BMoQyOPMNG/Mc2EaV1LMOOtoQ8R7X5U8ri5VlgjbOtfZLOWgH2fGpbCU87Yp9/R5Yu43hjTR+UzXJoZpIaWEvAnrLIwmyEcl2z+/WMtBOZ61wfH8ppxflPPJdnyy7mdVEWJAa/WS+5Z8E4qgxGF9IMSuInYJ71tyP9KlXP3r/bqn6y1G3vUv3JJfW1yTJds/tbBtPU3zUWNN09yDv9H8LOLNUbd8HXVzIkSrKtoQaL2/k/4PfZNehP8AVfoagBqOKPQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img2.png\"\n        title=\"img2.png\"\n        src=\"/dev-blog/static/fa422719316722043492fab389c58083/f058b/img_2.png\"\n        srcset=\"/dev-blog/static/fa422719316722043492fab389c58083/c26ae/img_2.png 158w,\n/dev-blog/static/fa422719316722043492fab389c58083/6bdcf/img_2.png 315w,\n/dev-blog/static/fa422719316722043492fab389c58083/f058b/img_2.png 630w,\n/dev-blog/static/fa422719316722043492fab389c58083/40601/img_2.png 945w,\n/dev-blog/static/fa422719316722043492fab389c58083/eb2af/img_2.png 954w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/dev-blog/static/184c1f99072ac796cc4f220b62362ff7/37048/img_3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.911392405063296%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAAA8ElEQVQoz4WRa24DMQiEfZysMWD8XDfJ/Y81lb1OlaqR+uMTY5ARDI4LgzODq2DpwggWwClc+XTVV27XvPcLIvqDsy6Y5CGwoYjNIFGhppCJBqgSRPl6R0UIDPL00/gd1+RAVY+hN9TIqH2g9RPtHEsXEwy7oeaI0k70MZBbBauAmBCYVnzhaE7wiNCnXfEui/jQrSPkHhGfEXLOlQlh2yGTbdlLO5IA6QKpu9gEMtk5T9urcOFfqx6fcSqEXAOsGqwZSheUrkgjw3paXtKbR58O8esoiQ9UOWCWkFLBVxWMosi5IueGZAlEHn5/+K/pNytW2ACa6Fi9AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img3.png\"\n        title=\"img3.png\"\n        src=\"/dev-blog/static/184c1f99072ac796cc4f220b62362ff7/f058b/img_3.png\"\n        srcset=\"/dev-blog/static/184c1f99072ac796cc4f220b62362ff7/c26ae/img_3.png 158w,\n/dev-blog/static/184c1f99072ac796cc4f220b62362ff7/6bdcf/img_3.png 315w,\n/dev-blog/static/184c1f99072ac796cc4f220b62362ff7/f058b/img_3.png 630w,\n/dev-blog/static/184c1f99072ac796cc4f220b62362ff7/40601/img_3.png 945w,\n/dev-blog/static/184c1f99072ac796cc4f220b62362ff7/78612/img_3.png 1260w,\n/dev-blog/static/184c1f99072ac796cc4f220b62362ff7/37048/img_3.png 1352w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">💡 StatementInspector를 implements하고 있는 JpaInspector 클래스를 작성했습니다.\ninspect를 Override 하면 실행될 sql문을 가로챌 수 있는데요.\n\n해당 메서드를 통해 API당 발생하는 `sql문을 저장`하고 `쿼리 개수`를 세주는 작업을 했습니다.</code></pre></div>\n<h2>QueryCountInterceptor로 JpaInspector관리하고 필요한 정보 파일로 추출하기</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/dev-blog/static/cac19cfb20f7c5198ff83f62e2189bf6/b8bf8/img_4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.32911392405063%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABpElEQVQoz22Sa3LbMAyEfZuaD4APkJIoO+n9T/V1SNlJO80PDCktASx2cSsaaOqwFKnVsL5TrFNzpSchS0RTRjWhKeFDwHmP9w6/To9zDu+u71uMka6eLXuOphybsbdCzxkrjVwMUSXNoimT9GqSNKOSUFVyqaSUmLVuKpGt3ukWsSzUFLASSdExsZTLYjaTZpScXgULKrqYLyxnRGZBjYz2i57vVPXsLbGXwGaZtg+2fdD6diUlpYijtk4xw1q/mlRb7NbIIU42wl6MXgrWGi3LYpurUa0tljNhRfDf9xgJ7zMEvA/coggSI1UjWQIhxAU4d4n9jrcBE/Nfpvz936+ia+Te7uTkkBhIGlAJ675YzIYixCgXG+8WgWnUCtEvfI08hd/LnZ4dm+lyejflUQPHGByPD8aMzRjng2Nr9Fap1in10m/pWMpLwxBJIhxbp+8ntXbG/sHYB4/nJ+fzk2OcnOfJOJ+M40nNRs7ly5C5Mm85bnPuCT7O3+vxZGNm/400zymBhKm5vhY9r5Wa+GWK57bmF1kL+i7yk+A/x7/vpil/AE4YVFOu3tLOAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img4.png\"\n        title=\"img4.png\"\n        src=\"/dev-blog/static/cac19cfb20f7c5198ff83f62e2189bf6/f058b/img_4.png\"\n        srcset=\"/dev-blog/static/cac19cfb20f7c5198ff83f62e2189bf6/c26ae/img_4.png 158w,\n/dev-blog/static/cac19cfb20f7c5198ff83f62e2189bf6/6bdcf/img_4.png 315w,\n/dev-blog/static/cac19cfb20f7c5198ff83f62e2189bf6/f058b/img_4.png 630w,\n/dev-blog/static/cac19cfb20f7c5198ff83f62e2189bf6/40601/img_4.png 945w,\n/dev-blog/static/cac19cfb20f7c5198ff83f62e2189bf6/78612/img_4.png 1260w,\n/dev-blog/static/cac19cfb20f7c5198ff83f62e2189bf6/b8bf8/img_4.png 1728w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">💡 `QueryCountInterceptor` 의 preHandle에서 api 요청이 올 때 마다, jpaInspector의 start()를 호출하여 `JpaInspector` 의 `QueryCounter` 객체를 초기화 합니다.\n\n그리고 `afterCompletion` 에서 JpaInspector에서 필요한 정보를 가져와 파일로 추출합니다.\n\n위와 같이 크게 `JpaInspector`, `QueryCountInterceptor` 등으로 구성된 프로젝트를 jitpack을 사용해 라이브러리로 배포했습니다.</code></pre></div>\n<h2>사용법</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">repositories{\n    mavenCentral()\n    maven{url 'https://jitpack.io'}\n}\n\ndependencies { \n\t...\n\timplementation 'com.github.sogorae:jpa-query-counter:1.0.4'\n}</code></pre></div>\n<p>위와 같이 build.gradle에 <strong><code class=\"language-text\">maven{url 'https://jitpack.io'}</code>, <code class=\"language-text\">implementation 'com.github.sogorae:jpa-query-counter:1.0.4'</code></strong> 를 추가한 후, e2e 테스트(ex. 인수 테스트)를 실행하면 원하는 정보가 파일로 추출됩니다.\n<a href=\"https://github.com/sogorae/jpa-query-counter\">라이브러리 링크</a></p>\n<h2>실행 결과</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/dev-blog/static/3a0a676a38890618e577e23edff6c55a/e8950/img_5.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.86075949367089%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACXElEQVQoz2WRXYvbRhiF9V+abLy7lqxvaWY0ow/bsnflD8mOnGTDJiGFQkubi+SiP/8pGm8g0IuHcw4DD7yMs+padNfSjQOHsac97HjXnxi7Heuyop2oatZlybLQrPQLv/S1MTSqYCMkTnva8PB85vz7E+OXkXrXouMEk2bEQUgSBKRhROz7hK5L6HoEU3redXsekeviLhb8+eo3nPVpy+nThePTQHveYh6WFGGMEoI4F8RpTpwJMlmQCkkqFEkmbGZS2UwzgZdL/rm9w1kNG46fR959/UD3fo95XKKjFF2uyUxNkl8lmdLkhbmiDYlQCFMhdIkoNItC8+3mBmd72bF9vnD58p7Dx4HycYmIBLrYoxKF9FyUH6B83yI9D/GC9BbIxQLlL8h8n8vNa5z+0NHUJVIXSFOQS0Ho+0TeHH8+J/C8FxYs5nPmszfMZ7P/4c5mvLm9xVmNf1AfnzH7jzT9Z8z+mXxzIW8eycySpGhIitoSq+qX3dgdyeqaqiI3S5zq6QfbT//SfPhOOX4j3v+FGP5GNY/UTUPVLC1l3VBog9KGwpSWbPq0JMXzA9zpgiDAqVYlp/PA6TSwP+zZPmxoljV5nqOLAqO1Ta01QgjSJLFvUyZJTBxHBL5PEATc393hVG3LMF7Y9Se648Cm29O0W3IhKV5EUl67McbusqrsTtLUyqMoIgxDXNfFqTZr+vNbDsOJ3bGnO/TUqxYhpRVMTMJJNDGJfu5JlmUZSZJYqRU225bh7Wilk3DXD7QPHbkQKCVRStlTJ8HUJ0Ecx1Yy9TRN7Z7y/v6e/wCAo5yTnb1oLwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img5.png\"\n        title=\"img5.png\"\n        src=\"/dev-blog/static/3a0a676a38890618e577e23edff6c55a/f058b/img_5.png\"\n        srcset=\"/dev-blog/static/3a0a676a38890618e577e23edff6c55a/c26ae/img_5.png 158w,\n/dev-blog/static/3a0a676a38890618e577e23edff6c55a/6bdcf/img_5.png 315w,\n/dev-blog/static/3a0a676a38890618e577e23edff6c55a/f058b/img_5.png 630w,\n/dev-blog/static/3a0a676a38890618e577e23edff6c55a/40601/img_5.png 945w,\n/dev-blog/static/3a0a676a38890618e577e23edff6c55a/78612/img_5.png 1260w,\n/dev-blog/static/3a0a676a38890618e577e23edff6c55a/e8950/img_5.png 2000w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n위와 같이 실행된 쿼리 정보 파일을 보고 한 눈에 파악할 수 있게 되었습니다.</p>\n<h2>N+1 및 잘못된 쿼리 수정 결과</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/dev-blog/static/6f8766af49b829b0e7dd87471095fefb/e8950/img_6.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.86075949367089%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACIklEQVQoz1WT2XKbQBBF+R1jRzAgYDYYCa0GsUiW7Th5SpX//xdOaka2Unk4dW8zcOnugqidJtpxYne+sJ0mNvPEdn9gWLeslcEWJXUlqUuJyjKkEChxU5mKf5oKTJ4T7c47uvcTH5+/6N9PbK8HjKqQWUGW56RJGhCpCJoskjvfdZokLJKEIkmI9pcDm7cTL5+/ef/zk+5jxFpNkxesjMUpQyNV8CttaaSmUTqoP3NKh+5NWVFnOdFx7uivE/vzwHHu2QwHSq1Z5ksyIcjSlCwVdxZPT/x4fLyz8Bo/8hTHgejQDfTPJ5S2SNuga0cpFfmyRPiRRUYqBGmWBZJU3PFnifjSrzran0b6+Uy9bjGNw7jVLTBfkiRp2I0n+MWC+OGBOI6J44cv4v+IduNMP19pjz1ud2TTDdh2R1U7dN2gjKVSmkprCqnCy0qlb0jFsqwoKnU7U5qoWG+x3YjrZqrNM6LekjY7ytUO5xxtu2HdtoHGOWxdB/UYYymrKoz76He7SIiMc3TjwPXtjcv1lXE+s39+xq3WSCmx1t4whrquKYuCsiypqorlchl8URTBCyGIlHMch4H55ZXejz/ObI8d1q1RStE0TQjy3quvPb57H/aNDwuBZrX6CrwynC+BbpyoV/8CjTFYe+uwri1KyXBNa30PzP0Xkaa3Dg+nE8N8oZ9mDv2JYz/QrNvwgA/xI3v1XXmVSoV1ePX3BC9l+LP+ApwjlhTywOdOAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img.png\"\n        title=\"img.png\"\n        src=\"/dev-blog/static/6f8766af49b829b0e7dd87471095fefb/f058b/img_6.png\"\n        srcset=\"/dev-blog/static/6f8766af49b829b0e7dd87471095fefb/c26ae/img_6.png 158w,\n/dev-blog/static/6f8766af49b829b0e7dd87471095fefb/6bdcf/img_6.png 315w,\n/dev-blog/static/6f8766af49b829b0e7dd87471095fefb/f058b/img_6.png 630w,\n/dev-blog/static/6f8766af49b829b0e7dd87471095fefb/40601/img_6.png 945w,\n/dev-blog/static/6f8766af49b829b0e7dd87471095fefb/78612/img_6.png 1260w,\n/dev-blog/static/6f8766af49b829b0e7dd87471095fefb/e8950/img_6.png 2000w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n여기까지 어떻게 N+1 문제를 찾았는지에 대한 내용을 다뤄보았는데요.</p>\n<p>다음 글에는 공책 팀에서 n+1 문제, 예상치 못하게 발생한 잘못된 쿼리가 무엇이고 어떻게 해결했는지에 대해 다뤄보겠습니다.</p>\n<p><strong>참고:</strong></p>\n<ul>\n<li><a href=\"https://docs.jboss.org/hibernate/orm/5.2/javadocs/org/hibernate/resource/jdbc/spi/StatementInspector.html\">https://docs.jboss.org/hibernate/orm/5.2/javadocs/org/hibernate/resource/jdbc/spi/StatementInspector.html</a></li>\n<li><a href=\"https://vladmihalcea.com/hibernate-statementinspector/\">https://vladmihalcea.com/hibernate-statementinspector/</a>, <a href=\"http://knes1.github.io/blog/2015/2015-07-08-counting-queries-per-request-with-hibernate-and-spring.html\">http://knes1.github.io/blog/2015/2015-07-08-counting-queries-per-request-with-hibernate-and-spring.html</a></li>\n</ul>","fields":{"slug":"/BE/범고래/N+1/nplus1/"},"frontmatter":{"title":"JPA N+1 문제 찾아 삼만리","date":"2022.09.16","description":"JPA N+1 문제 찾아 삼만리","tags":["JPA","N+1"]}}},"pageContext":{"id":"b0207c5a-083f-5d84-8419-8646dc49124b","previousPostId":"3d16a0f2-db0f-56d2-bde0-24277b186828","nextPostId":"be2a70d3-e2c8-563c-be43-005450c9ef90"}},"staticQueryHashes":["2841359383"]}